const mysql = require('mysql2');
const util = require('util');

// ุฅุนุฏุงุฏ ุงูุงุชุตุงู ุจูุงุนุฏุฉ ุงูุจูุงูุงุช
const db = mysql.createConnection({
  host: '89.163.214.37',             // ุนููุงู ุงูุณูุฑูุฑ (MaznHost)
  user: 'amlhabra_brak',             // ุงุณู ุงููุณุชุฎุฏู
  password: 'hSgMaUAGjPdGa7ZfRM6T',  // ูููุฉ ุงููุฑูุฑ
  database: 'amlhabra_brak',         // ุงุณู ูุงุนุฏุฉ ุงูุจูุงูุงุช
  port: 3306,                        // ุงูุจูุฑุช ุงูุงูุชุฑุงุถู ูู MySQL
  charset: 'utf8mb4',               // ุงูุชุฑููุฒ ูุฏุนู ุงูุฑููุฒ ุงูุนุฑุจูุฉ ูุงูุฅูููุฌู
  connectTimeout: 30000,            // ูููุฉ ุงูุงุชุตุงู
  acquireTimeout: 30000             // ูููุฉ ุงูุญุตูู ุนูู ุงุชุตุงู
});

// ูุญุงููุฉ ุงูุงุชุตุงู
db.connect((err) => {
  if (err) {
    console.error("โ ูู ูุชู ุงูุงุชุตุงู ุจูุงุนุฏุฉ ุงูุจูุงูุงุช:", err.message);
    console.error("ุชูุงุตูู ุงูุฎุทุฃ:", err);
    return;
  }
  console.log("โ ุชู ุงูุงุชุตุงู ุจูุงุนุฏุฉ ุงูุจูุงูุงุช ุจูุฌุงุญ");
});

// ูุนุงูุฌ ุฃุฎุทุงุก ุงูุงุชุตุงู ุจุนุฏ ุงูุชุดุบูู
db.on('error', (err) => {
  console.error('โ๏ธ ุฎุทุฃ ูู ุงูุงุชุตุงู ุจูุงุนุฏุฉ ุงูุจูุงูุงุช:', err);
  if (err.code === 'PROTOCOL_CONNECTION_LOST') {
    console.log('๐ ุชู ููุฏุงู ุงูุงุชุตุงูุ ูููุถู ุฅุนุงุฏุฉ ุชุดุบูู ุงูุงุชุตุงู ุฃู ุงูุณูุฑูุฑ.');
    // ูููู ุฅุถุงูุฉ ููุทู ูุฅุนุงุฏุฉ ุงูุงุชุตุงู ููุง ูุงุญููุง
  } else {
    throw err;
  }
});

// ุชุญููู ุฏูุงู ุงูุงุณุชุนูุงู ุฅูู ูุนูุฏ (Promises)
db.query = util.promisify(db.query);

module.exports = db;